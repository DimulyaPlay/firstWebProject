{% extends 'layout.html' %}

{% block content %}
<br>
<form method="GET" action="{{ url_for('views.outbox') }}" class="form-inline mb-2" style="margin-top: 10px;user-select: text;">
  <div class="input-group">
      <input type="text" name="search" class="form-control rounded-0" placeholder="Поиск по теме" value="{{ search_query }}">
      <div class="input-group-append">
          <button type="submit" class="btn btn-primary rounded-0">Искать</button>
      </div>
  </div>
</form>


<table class="table table-hover">
    <thead>
    <tr>
      <th scope="col">Тема отправления</th>
      <th scope="col">Кому отправлено подпись</th>
      <th scope="col">Подписано</th>
      <th scope="col">В Росреестр</th>
      <th scope="col">На эл. почту</th>
      <th scope="col">Отчет об отправке</th>
    </tr>
    </thead>
    <tbody>
     
    {% if messages %}
    
        {% for message in messages %}
            {% if message.signed %}
            <tr class="table-success">
            {% else %}
            <tr class="table-warning">
            {% endif %}

            <th scope="row">{{ message.mailSubject }}</th>

            <td>{{ message.sigBy }}</td>

            {% if message.signed %}
            <td>Да</td>
            {% else %}
            <td>Нет</td>
            {% endif %}

            {% if message.toRosreestr %}
            <td><img src="static/img/rosreestr-icon.png" alt="Rosreestr"></td>
            {% else %}
            <td><img src="static/img/no-rosreestr-icon.png" alt="No Rosreestr"></td>
            {% endif %}

            {% if message.toEmails %}
            <td><img src="static/img/email-icon.png" alt="Email"></td> 
            {% else %}
            <td><img src="static/img/no-email-icon.png" alt="No Email"></td> 
            {% endif %}

            {% if report_exists(message.id) %}
            <td>
              <a href="{{ url_for('views.get_report', message_id=message.id) }}" target="_blank">
              <img src="static/img/report-icon.png" alt="Report" href="{{ url_for('views.get_report', message_id=message.id) }}">
              </a>
            </td>
            {% else %}
            <td><img src="static/img/no-report-icon.png" alt="No Report"></td>
            {% endif %}
            </tr>
        {% endfor %}
         
    {% else %}
    <tr>
        <th scope="row">Сообщений нет</th>
        <td> </td>
        <td> </td>
        <td> </td>
        <td> </td>        
        <td> </td>  
    </tr> 
    {% endif %}
    
</tbody>
</table>

<nav aria-label="Page navigation" class="d-flex justify-content-center">
  <ul class="pagination">

      <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('views.outbox', page=1, search=search_query) }}" tabindex="-1" aria-disabled="true">В начало</a>
      </li>
      <li class="page-item {% if current_page == 1 %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('views.outbox', page=current_page-1 , search=search_query) }}" tabindex="-1" aria-disabled="true">Назад</a>
      </li>

      {% for page_num in range(start_index_pages, end_index_pages+1) %}
          <li class="page-item {% if page_num == current_page %}active{% endif %}">
              <a class="page-link" href="{{ url_for('views.outbox', page=page_num, search=search_query) }}">{{ page_num }}</a>
          </li>
      {% endfor %}

      <li class="page-item {% if current_page + 1 > total_pages %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('views.outbox', page=current_page+1 , search=search_query) }}" tabindex="-1" aria-disabled="true">Вперед</a>
      </li>
      <li class="page-item {% if current_page == total_pages %}disabled{% endif %}">
        <a class="page-link" href="{{ url_for('views.outbox', page=total_pages , search=search_query) }}" tabindex="-1" aria-disabled="true">В конец</a>
      </li>
  </ul>
</nav>


<br><br><br>
<table class="table table-hover">
    <thead>
        <tr>
          <th scope="col">Цветовая разметка</th>
        </tr>
        </thead>
    <tbody>
    <tr class="table-success">
      <th scope="row">Отправлено успешно</th>
    </tr>
    <tr class="table-danger">
      <th scope="row">Ошибка при отправке</th>
    </tr>
    <tr class="table-warning">
      <th scope="row">Не подписано</th>
    </tr>
    </tbody>
  </table>
{% endblock content %}